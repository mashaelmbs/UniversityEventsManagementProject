@using UniversityEventsManagement.Controllers
@using Microsoft.AspNetCore.Mvc.Localization
@model ResetPasswordViewModel
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = "إعادة تعيين كلمة المرور";
}

@section Styles {
    <style>
        .reset-password-icon-wrapper {
            display: inline-block;
            padding: 20px;
            background: linear-gradient(135deg, #5E8C3E 0%, #66B2FF 100%);
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(94, 140, 62, 0.3);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .reset-password-icon-wrapper:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 6px 20px rgba(94, 140, 62, 0.4);
        }

        .reset-password-icon {
            color: white;
            font-size: 3rem;
            display: block;
        }

        .info-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 4px solid #66B2FF;
        }

        .btn-success {
            background: linear-gradient(135deg, #5E8C3E 0%, #6F9E5A 100%);
            border: none;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #4a7032 0%, #5a8d48 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(94, 140, 62, 0.4);
        }
    </style>
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card mt-5">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <div class="reset-password-icon-wrapper">
                            <i class="fas fa-lock reset-password-icon"></i>
                        </div>
                        <h2 class="mt-3">إعادة تعيين كلمة المرور</h2>
                    </div>

                    <div class="info-box">
                        <p class="mb-0">
                            <i class="fas fa-info-circle text-primary"></i>
                            تم إرسال رمز التحقق إلى بريدك الإلكتروني. يرجى إدخال الرمز وكلمة المرور الجديدة أدناه.
                        </p>
                    </div>

                    <form method="post" asp-action="ResetPassword">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <div class="mb-4">
                            <label asp-for="Code" class="form-label">رمز التحقق</label>
                            <input asp-for="Code" 
                                   type="text" 
                                   class="form-control form-control-lg text-center" 
                                   placeholder="000000"
                                   maxlength="6"
                                   pattern="[0-9]{6}"
                                   style="font-size: 20px; letter-spacing: 8px; font-weight: bold;"
                                   required 
                                   autocomplete="off"
                                   autofocus>
                            <span asp-validation-for="Code" class="text-danger"></span>
                            <small class="form-text text-muted">أدخل الرمز المكون من 6 أرقام المرسل إلى بريدك</small>
                        </div>

                        <div class="mb-3">
                            <label asp-for="NewPassword" class="form-label">كلمة المرور الجديدة</label>
                            <input asp-for="NewPassword" 
                                   type="password" 
                                   class="form-control" 
                                   placeholder="أدخل كلمة المرور الجديدة"
                                   required>
                            <span asp-validation-for="NewPassword" class="text-danger"></span>
                            <small class="form-text text-muted">يجب أن تكون كلمة المرور على الأقل 6 أحرف</small>
                        </div>

                        <div class="mb-4">
                            <label asp-for="ConfirmPassword" class="form-label">تأكيد كلمة المرور</label>
                            <input asp-for="ConfirmPassword" 
                                   type="password" 
                                   class="form-control" 
                                   placeholder="أعد إدخال كلمة المرور الجديدة"
                                   required>
                            <span asp-validation-for="ConfirmPassword" class="text-danger"></span>
                        </div>

                        <button type="submit" class="btn btn-success btn-lg w-100 mb-3">
                            <i class="fas fa-check-circle"></i> إعادة تعيين كلمة المرور
                        </button>

                        <form method="post" asp-action="ResendPasswordResetCode" class="text-center">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-link text-decoration-none">
                                <i class="fas fa-redo"></i> إعادة إرسال الرمز
                            </button>
                        </form>

                        <div class="text-center mt-3">
                            <a href="/Account/ForgotPassword" class="text-muted">
                                <i class="fas fa-arrow-right"></i> العودة إلى استعادة كلمة المرور
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Auto-format OTP input to numbers only
        document.querySelector('input[name="Code"]').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // Show toast messages
        @if (TempData["Info"] != null)
        {
            <text>
            $(document).ready(function() {
                alert('@Html.Raw(TempData["Info"])');
            });
            </text>
        }
        
        @if (TempData["Error"] != null)
        {
            <text>
            $(document).ready(function() {
                alert('@Html.Raw(TempData["Error"])');
            });
            </text>
        }
    </script>
}

