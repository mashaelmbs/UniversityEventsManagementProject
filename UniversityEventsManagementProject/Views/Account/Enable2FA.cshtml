@using UniversityEventsManagement.Controllers
@using Microsoft.AspNetCore.Mvc.Localization
@model Enable2FAViewModel
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = "إعدادات المصادقة الثنائية";
    if (User.IsInRole("Admin"))
    {
        Layout = "~/Views/Shared/_AdminLayout.cshtml";
    }
}

@section Styles {
    <style>
        .security-icon-wrapper {
            display: inline-block;
            padding: 20px;
            background: linear-gradient(135deg, #66B2FF 0%, #4A90E2 100%);
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(102, 178, 255, 0.3);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .security-icon-wrapper:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 178, 255, 0.4);
        }

        .security-icon {
            color: white;
            font-size: 3rem;
            display: block;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 0;
        }

        .status-enabled {
            background-color: #d4edda;
            color: #155724;
        }

        .status-disabled {
            background-color: #f8d7da;
            color: #721c24;
        }

        .info-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 4px solid #66B2FF;
        }

        .benefit-list {
            list-style: none;
            padding: 0;
        }

        .benefit-list li {
            padding: 10px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .benefit-list li:last-child {
            border-bottom: none;
        }

        .benefit-list i {
            color: #66B2FF;
            margin-left: 10px;
        }

        .btn-success {
            background: linear-gradient(135deg, #5E8C3E 0%, #6F9E5A 100%);
            border: none;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #4a7032 0%, #5a8d48 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(94, 140, 62, 0.4);
        }
    </style>
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card mt-5">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <div class="security-icon-wrapper">
                            <i class="fas fa-shield-alt security-icon"></i>
                        </div>
                        <h2 class="mt-3">إعدادات المصادقة الثنائية</h2>
                    </div>

                    <div class="text-center mb-4">
                        @if (Model.IsEnabled)
                        {
                            <span class="status-badge status-enabled">
                                <i class="fas fa-check-circle"></i> مفعّل
                            </span>
                        }
                        else
                        {
                            <span class="status-badge status-disabled">
                                <i class="fas fa-times-circle"></i> غير مفعّل
                            </span>
                        }
                    </div>

                    <div class="info-card">
                        <h5><i class="fas fa-info-circle"></i> ما هي المصادقة الثنائية؟</h5>
                        <p>
                            المصادقة الثنائية (2FA) تضيف طبقة إضافية من الأمان لحسابك. عند تفعيلها، 
                            سيتم إرسال رمز تحقق إلى بريدك الإلكتروني عند كل محاولة تسجيل دخول.
                        </p>
                        
                        <h6 class="mt-4">المميزات:</h6>
                        <ul class="benefit-list">
                            <li>
                                <i class="fas fa-lock"></i>
                                حماية إضافية من محاولات الاختراق
                            </li>
                            <li>
                                <i class="fas fa-envelope"></i>
                                إشعارات فورية عند تسجيل الدخول
                            </li>
                            <li>
                                <i class="fas fa-shield-alt"></i>
                                أمان أفضل لحسابك وبياناتك
                            </li>
                        </ul>
                    </div>

                    <form method="post" asp-action="Enable2FA">
                        @Html.AntiForgeryToken()

                        @if (Model.IsEnabled)
                        {
                            <input type="hidden" name="Enable" value="false" />
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <strong>تحذير:</strong> سيتم تعطيل المصادقة الثنائية لحسابك.
                            </div>
                            <button type="submit" class="btn btn-danger btn-lg w-100">
                                <i class="fas fa-times-circle"></i> تعطيل المصادقة الثنائية
                            </button>
                        }
                        else
                        {
                            <input type="hidden" name="Enable" value="true" />
                            <button type="submit" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-check-circle"></i> تفعيل المصادقة الثنائية
                            </button>
                        }
                    </form>

                    <div class="text-center mt-4">
                        <a href="/Account/Manage" class="text-muted">
                            <i class="fas fa-arrow-right"></i> العودة إلى إدارة الحساب
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        @if (TempData["Success"] != null)
        {
            <text>
            $(document).ready(function() {
                alert('@Html.Raw(TempData["Success"])');
            });
            </text>
        }
        
        @if (TempData["Error"] != null)
        {
            <text>
            $(document).ready(function() {
                alert('@Html.Raw(TempData["Error"])');
            });
            </text>
        }
    </script>
}

