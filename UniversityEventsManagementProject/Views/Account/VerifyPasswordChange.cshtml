@using UniversityEventsManagement.Controllers
@using Microsoft.AspNetCore.Mvc.Localization
@model VerifyPasswordChangeViewModel
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = "التحقق من تغيير كلمة المرور";
}

@section Styles {
    <style>
        .password-change-icon-wrapper {
            display: inline-block;
            padding: 20px;
            background: linear-gradient(135deg, #66B2FF 0%, #4A90E2 100%);
            border-radius: 50%;
            box-shadow: 0 4px 15px rgba(102, 178, 255, 0.3);
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .password-change-icon-wrapper:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 6px 20px rgba(102, 178, 255, 0.4);
        }

        .password-change-icon {
            color: white;
            font-size: 3rem;
            display: block;
        }

        .info-box {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-right: 4px solid #66B2FF;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6F4E37 0%, #A67C52 100%);
            border: none;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a3e2a 0%, #8b6340 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(111, 78, 55, 0.4);
        }
    </style>
}

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-5">
            <div class="card mt-5">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <div class="password-change-icon-wrapper">
                            <i class="fas fa-key password-change-icon"></i>
                        </div>
                        <h2 class="mt-3">التحقق من تغيير كلمة المرور</h2>
                    </div>

                    <div class="info-box">
                        <p class="mb-0">
                            <i class="fas fa-info-circle text-primary"></i>
                            تم إرسال رمز التحقق إلى بريدك الإلكتروني. يرجى إدخال الرمز المكون من 6 أرقام أدناه للمتابعة.
                        </p>
                    </div>

                    <form method="post" asp-action="VerifyPasswordChange" id="verifyForm">
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger"></div>

                        <div class="mb-4">
                            <label asp-for="Code" class="form-label text-center w-100">رمز التحقق</label>
                            <input asp-for="Code" 
                                   type="text" 
                                   class="form-control form-control-lg text-center" 
                                   placeholder="000000"
                                   maxlength="6"
                                   pattern="[0-9]{6}"
                                   style="font-size: 24px; letter-spacing: 8px; font-weight: bold;"
                                   required 
                                   autocomplete="off"
                                   autofocus>
                            <span asp-validation-for="Code" class="text-danger"></span>
                            <small class="form-text text-muted">أدخل الرمز المكون من 6 أرقام المرسل إلى بريدك</small>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mb-3">
                            <i class="fas fa-check-circle"></i> تأكيد وتغيير كلمة المرور
                        </button>

                        <form method="post" asp-action="ResendPasswordChangeCode" class="text-center">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-link text-decoration-none">
                                <i class="fas fa-redo"></i> إعادة إرسال الرمز
                            </button>
                        </form>

                        <div class="text-center mt-3">
                            <a href="/Account/ChangePassword" class="text-muted">
                                <i class="fas fa-arrow-right"></i> العودة إلى تغيير كلمة المرور
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        // Auto-format OTP input to numbers only
        document.querySelector('input[name="Code"]').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        // Show toast messages
        @if (TempData["Info"] != null)
        {
            <text>
            $(document).ready(function() {
                alert('@Html.Raw(TempData["Info"])');
            });
            </text>
        }
        
        @if (TempData["Error"] != null)
        {
            <text>
            $(document).ready(function() {
                alert('@Html.Raw(TempData["Error"])');
            });
            </text>
        }
    </script>
}

